


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Emprestimo</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">biblioteca.livros</a>
</div>

<h1>Coverage Summary for Class: Emprestimo (biblioteca.livros)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Emprestimo</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    95.2%
  </span>
  <span class="absValue">
    (20/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    62.3%
  </span>
  <span class="absValue">
    (66/106)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    89.9%
  </span>
  <span class="absValue">
    (116/129)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package biblioteca.livros;
&nbsp;
&nbsp;import java.io.*;
&nbsp;import java.util.ArrayList;
&nbsp;
&nbsp;
&nbsp;/* @author Luam */
&nbsp;
&nbsp;public class Emprestimo {
&nbsp;    private String CPF;
&nbsp;    private String ISNB;
&nbsp;    private String dataEmprestimo;
&nbsp;    private String dataDevolucao;
&nbsp;
<b class="fc">&nbsp;    public Emprestimo(String CPF, String ISNB, String dataEmprestimo, String dataDevolucao) {</b>
<b class="fc">&nbsp;        this.CPF= CPF;</b>
<b class="fc">&nbsp;        this.ISNB = ISNB;</b>
<b class="fc">&nbsp;        this.dataEmprestimo = dataEmprestimo;</b>
<b class="fc">&nbsp;        this.dataDevolucao = dataDevolucao;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public String getDataEmprestimo() {
<b class="fc">&nbsp;        return dataEmprestimo;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDataEmprestimo(String dataEmprestimo) {
<b class="fc">&nbsp;        this.dataEmprestimo = dataEmprestimo;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getCPF() {
<b class="fc">&nbsp;        return CPF;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setCPF(String CPF) {
<b class="fc">&nbsp;        this.CPF = CPF;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getISNB() {
<b class="fc">&nbsp;        return ISNB;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setISNB(String ISNB) {
<b class="fc">&nbsp;        this.ISNB = ISNB;</b>
&nbsp;    }
&nbsp;
&nbsp;    
&nbsp;    
&nbsp;
&nbsp;    public String getDataDevolucao() {
<b class="fc">&nbsp;        return dataDevolucao;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDataDevolucao(String dataDevolucao) {
<b class="fc">&nbsp;        this.dataDevolucao = dataDevolucao;</b>
&nbsp;    }
&nbsp;
&nbsp;    
&nbsp;     @Override
&nbsp;    public String toString() {
<b class="nc">&nbsp;        return (&quot;IdLivro: &quot; + this.getISNB() + &quot; - &quot; +&quot;CPF: &quot; + this.getCPF() </b>
<b class="nc">&nbsp;                + &quot; - &quot; +  &quot;Data de Emprestimo: &quot; + this.getDataEmprestimo() +</b>
<b class="nc">&nbsp;                &quot; - &quot; + &quot;Data de Devolução: &quot; + this.getDataDevolucao());</b>
&nbsp;    }
&nbsp;    // checar devolução
&nbsp;    
&nbsp;    public static void escreverEmprestimo(Emprestimo emprestimo, String path) {
<b class="fc">&nbsp;        BufferedWriter bw = null;</b>
<b class="fc">&nbsp;        String linha = emprestimo.getCPF()+&quot;,&quot;+emprestimo.getISNB()+&quot;,&quot;+emprestimo.getDataEmprestimo()+&quot;,&quot;+</b>
<b class="fc">&nbsp;                emprestimo.getDataDevolucao();</b>
&nbsp;        try {
<b class="fc">&nbsp;            bw = new BufferedWriter(new FileWriter(path+&quot;emprestimos.csv&quot;, true));</b>
<b class="fc">&nbsp;            PrintWriter pw= new PrintWriter(bw);</b>
<b class="fc">&nbsp;            pw.println(linha);</b>
<b class="fc">&nbsp;            pw.flush();</b>
&nbsp;            pw.close();
&nbsp;        } catch (FileNotFoundException e) {
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } finally {
<b class="pc">&nbsp;            if (bw != null) {</b>
&nbsp;                try {
&nbsp;                    bw.close();
&nbsp;                } catch (IOException e) {
<b class="nc">&nbsp;                    e.printStackTrace();</b>
&nbsp;                }
&nbsp;            }   
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static ArrayList&lt;Emprestimo&gt; leitorEmprestimos(String path){
<b class="fc">&nbsp;        BufferedReader br = null;</b>
<b class="fc">&nbsp;        String linha = &quot;&quot;;</b>
<b class="fc">&nbsp;        ArrayList&lt;Emprestimo&gt; emprestimos = new ArrayList&lt;&gt;();</b>
&nbsp;        try {
<b class="fc">&nbsp;            br = new BufferedReader(new FileReader(path+&quot;emprestimos.csv&quot;));</b>
<b class="fc">&nbsp;            br.readLine();</b>
&nbsp;            
<b class="fc">&nbsp;            while ((linha = br.readLine()) != null) {</b>
<b class="fc">&nbsp;                String[] emprestimo = linha.split(&quot;,&quot;);</b>
<b class="fc">&nbsp;                Emprestimo novo = new Emprestimo(emprestimo[0],emprestimo[1],emprestimo[2],emprestimo[3]);</b>
<b class="fc">&nbsp;                emprestimos.add(novo);</b>
&nbsp;            }
<b class="fc">&nbsp;            return emprestimos;</b>
&nbsp;            
&nbsp;        } catch (FileNotFoundException e) {
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } finally {
<b class="pc">&nbsp;            if (br != null) {</b>
&nbsp;                try {
&nbsp;                    br.close();
&nbsp;                } catch (IOException e) {
<b class="nc">&nbsp;                    e.printStackTrace();</b>
&nbsp;                }
&nbsp;            }   
&nbsp;        }
<b class="fc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void removerEmprestimo(Emprestimo emprestimoRemovido, String path) {
<b class="fc">&nbsp;        BufferedReader br = null;</b>
<b class="fc">&nbsp;        BufferedWriter bw = null;</b>
<b class="fc">&nbsp;        File antigo = new File(path+&quot;emprestimos.csv&quot;);</b>
<b class="fc">&nbsp;        File novo = new File (path+&quot;temp.csv&quot;);</b>
&nbsp;        
&nbsp;        try {
<b class="fc">&nbsp;            br = new BufferedReader(new FileReader(antigo));</b>
<b class="fc">&nbsp;            bw = new BufferedWriter(new FileWriter(novo, true));</b>
<b class="fc">&nbsp;            PrintWriter pw= new PrintWriter(bw);</b>
<b class="fc">&nbsp;            String linha = &quot;&quot;;</b>
&nbsp;            
<b class="fc">&nbsp;            while ((linha = br.readLine()) != null) {</b>
&nbsp;    
<b class="fc">&nbsp;                String[] emprestimo = linha.split(&quot;,&quot;);</b>
<b class="fc">&nbsp;                if ((!emprestimo[0].equals(emprestimoRemovido.getCPF()))</b>
<b class="pc">&nbsp;                        &amp;&amp; (!emprestimo[1].equals(emprestimoRemovido.getISNB()))){</b>
<b class="fc">&nbsp;                    pw.println(linha);</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            pw.flush();  </b>
&nbsp;            pw.close();
&nbsp;            br.close();
<b class="fc">&nbsp;            antigo.delete();</b>
&nbsp;            
<b class="fc">&nbsp;            File aux = new File (path+&quot;emprestimos.csv&quot;);</b>
<b class="fc">&nbsp;            novo.renameTo(aux);</b>
&nbsp;            
&nbsp;        } catch (FileNotFoundException e) {
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } finally {
<b class="pc">&nbsp;            if (bw != null) {</b>
&nbsp;                try {
&nbsp;                    bw.close();
&nbsp;                } catch (IOException e) {
<b class="nc">&nbsp;                    e.printStackTrace();</b>
&nbsp;                }
&nbsp;            }   
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static void modificarEmprestimo(Acervo acervo, Livro livroEmprestado, String path, String booleano) {
<b class="fc">&nbsp;        BufferedReader br = null;</b>
<b class="fc">&nbsp;        BufferedWriter bw = null;</b>
<b class="fc">&nbsp;        File antigo = new File(path + &quot;/livros.csv&quot;);</b>
<b class="fc">&nbsp;        File novo = new File(path + &quot;/temp.csv&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            br = new BufferedReader(new FileReader(antigo));</b>
<b class="fc">&nbsp;            bw = new BufferedWriter(new FileWriter(novo, true));</b>
<b class="fc">&nbsp;            PrintWriter pw = new PrintWriter(bw);</b>
&nbsp;            String linha;
&nbsp;            String linhaEditada;
&nbsp;
<b class="fc">&nbsp;            while ((linha = br.readLine()) != null) {</b>
&nbsp;
&nbsp;                // 1) Linha vazia
<b class="fc">&nbsp;                if (linha.trim().isEmpty()) {</b>
<b class="fc">&nbsp;                    pw.println(linha);</b>
&nbsp;                    continue;
&nbsp;                }
&nbsp;
&nbsp;                // 2) Cabeçalho
<b class="fc">&nbsp;                if (isHeaderLine(linha)) {</b>
<b class="fc">&nbsp;                    pw.println(linha);</b>
&nbsp;                    continue;
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                String[] livro = linha.split(&quot;,&quot;);</b>
&nbsp;                // 3) Linha malformada (poucos campos)
<b class="fc">&nbsp;                if (livro.length &lt; 2) {</b>
<b class="fc">&nbsp;                    pw.println(linha);</b>
&nbsp;                    continue;
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                boolean titleEquals = safeEquals(livro, 1, livroEmprestado.getTitulo());</b>
<b class="fc">&nbsp;                boolean titleEqualsIgnore = safeEqualsIgnoreCase(livro, 1, livroEmprestado.getTitulo());</b>
<b class="fc">&nbsp;                boolean titleContains = safeContains(livro, 1, livroEmprestado.getTitulo());</b>
<b class="fc">&nbsp;                boolean alreadyFlagged = (livro.length &gt; 6 &amp;&amp; &quot;true&quot;.equalsIgnoreCase(livro[7]));</b>
&nbsp;
&nbsp;                // 4) Vários ramos de decisão para aumentar a C.C.
<b class="fc">&nbsp;                if (titleEquals) {</b>
<b class="fc">&nbsp;                    livro = ensureFields(livro, 8);</b>
<b class="fc">&nbsp;                    livro[6] = booleano;</b>
<b class="fc">&nbsp;                    linhaEditada = joinFields(livro);</b>
<b class="fc">&nbsp;                } else if (titleEqualsIgnore) {</b>
&nbsp;                    // tratar diferença de caixa como menos prioritário: apenas marca se ainda não estiver marcado
<b class="fc">&nbsp;                    livro = ensureFields(livro, 8);</b>
<b class="fc">&nbsp;                    if (!alreadyFlagged) {</b>
<b class="fc">&nbsp;                        livro[6] = booleano;</b>
&nbsp;                    }
<b class="fc">&nbsp;                    linhaEditada = joinFields(livro);</b>
<b class="fc">&nbsp;                } else if (titleContains &amp;&amp; &quot;true&quot;.equalsIgnoreCase(booleano)) {</b>
&nbsp;                    // se título contém e estamos marcando como emprestado, atualiza
<b class="fc">&nbsp;                    livro = ensureFields(livro, 8);</b>
<b class="fc">&nbsp;                    livro[6] = booleano;</b>
<b class="fc">&nbsp;                    linhaEditada = joinFields(livro);</b>
<b class="pc">&nbsp;                } else if (isMalformedLine(livro)) {</b>
&nbsp;                    // linha com conteúdo inesperado: preserva tal como está
<b class="nc">&nbsp;                    linhaEditada = linha;</b>
<b class="pc">&nbsp;                } else if (livro.length &gt;= 8 &amp;&amp; livro[7] != null &amp;&amp; !livro[7].isEmpty()) {</b>
&nbsp;                    // outro ramo que mantém a linha original se campo 8 estiver presente
<b class="fc">&nbsp;                    linhaEditada = linha;</b>
&nbsp;                } else {
&nbsp;                    // caso padrão: mantém a linha original sem alteração
<b class="nc">&nbsp;                    linhaEditada = linha;</b>
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                pw.println(linhaEditada);</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            pw.flush();</b>
&nbsp;            pw.close();
&nbsp;            br.close();
<b class="fc">&nbsp;            antigo.delete();</b>
&nbsp;
<b class="fc">&nbsp;            File aux = new File(path + &quot;/livros.csv&quot;);</b>
<b class="fc">&nbsp;            novo.renameTo(aux);</b>
&nbsp;
&nbsp;        } catch (FileNotFoundException e) {
<b class="fc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            e.printStackTrace();</b>
&nbsp;        } finally {
<b class="pc">&nbsp;            if (bw != null) {</b>
&nbsp;                try {
&nbsp;                    bw.close();
&nbsp;                } catch (IOException e) {
<b class="nc">&nbsp;                    e.printStackTrace();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // Helpers adicionados para suportar validações acima
&nbsp;    private static boolean isHeaderLine(String linha) {
<b class="fc">&nbsp;        String lower = linha.toLowerCase();</b>
<b class="pc">&nbsp;        return lower.contains(&quot;titulo&quot;) &amp;&amp; lower.contains(&quot;autor&quot;) &amp;&amp; lower.contains(&quot;paginas&quot;) &amp;&amp; lower.contains(&quot;estaemprestado&quot;) ;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean safeEquals(String[] arr, int idx, String value) {
<b class="pc">&nbsp;        return (arr.length &gt; idx &amp;&amp; arr[idx] != null) &amp;&amp; arr[idx].equals(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean safeEqualsIgnoreCase(String[] arr, int idx, String value) {
<b class="pc">&nbsp;        return (arr.length &gt; idx &amp;&amp; arr[idx] != null) &amp;&amp; arr[idx].equalsIgnoreCase(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean safeContains(String[] arr, int idx, String value) {
<b class="pc">&nbsp;        return (arr.length &gt; idx &amp;&amp; arr[idx] != null) &amp;&amp; arr[idx].contains(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean isMalformedLine(String[] arr) {
<b class="fc">&nbsp;        int empty = 0;</b>
<b class="fc">&nbsp;        for (String s : arr) {</b>
<b class="pc">&nbsp;            if (s == null || s.trim().isEmpty()) empty++;</b>
&nbsp;        }
<b class="pc">&nbsp;        return empty &gt;= arr.length - 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static String[] ensureFields(String[] arr, int size) {
<b class="fc">&nbsp;        if (arr.length &gt;= size) return arr;</b>
<b class="fc">&nbsp;        String[] n = new String[size];</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; size; i++) {</b>
<b class="fc">&nbsp;            if (i &lt; arr.length) n[i] = arr[i];</b>
<b class="fc">&nbsp;            else n[i] = &quot;&quot;;</b>
&nbsp;        }
<b class="fc">&nbsp;        return n;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static String joinFields(String[] arr) {
<b class="fc">&nbsp;        StringBuilder sb = new StringBuilder();</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; arr.length; i++) {</b>
<b class="fc">&nbsp;            if (i &gt; 0) sb.append(&quot;,&quot;);</b>
<b class="pc">&nbsp;            sb.append(arr[i] == null ? &quot;&quot; : arr[i]);</b>
&nbsp;        }
<b class="fc">&nbsp;        return sb.toString();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-12-01 14:10</div>
</div>
</body>
</html>
